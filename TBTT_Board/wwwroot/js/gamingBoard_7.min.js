$(function(){function c(n,i){var f=$("div#urlGetGameList").data("request-url"),u=$(r).text();t=$(i);var e=n,o='<ul><li id="CourtNameRoot" data-nodeid = "-999" data-jstree=\'{"icon":"fa fa-hourglass-1"}\'><a class="courtName" data-nodeid = "-999" href="#"> '+e+" <\/a>",s="<\/li><\/ul>";$.ajax({type:"GET",contentType:"application/json",url:f,async:!1,data:{CourtName:n},cache:!1,success:function(n){n.length<=40&&$(r).html("");u!=null&&(u=u.trim());t.jstree("destroy");t.html("");n=o+n+s;t.html(n);t.jstree({core:{multiple:!1,check_callback:function(n){return n==="delete_node"?!0:n==="move_node"?!1:!0}},plugins:["dnd","contextmenu"],contextmenu:{items:p},dnd:{is_draggable:!0}});t.jstree("open_all");t.jstree(!0).redraw()},error:function(n){if(n.status===401){error(TBTTCONSTANT.UNAUTHORIZEDREQUEST);return}n.status===403?error(TBTTCONSTANT.UNAUTHORIZEDREQUEST):error(TBTTCONSTANT.GENERIC_ERROR)}});return}function p(u){return{deleteItem:{label:"Delete",action:function(){var l=$("div#urlDeleteFromGameBoardByMembershipID").data("request-url"),v=$("[name=__RequestVerificationToken]").val(),h={},o,s,e;h.__RequestVerificationToken=v;u!=null&&u.a_attr!=null&&(o=u.a_attr["data-nodemembername"],i=u.a_attr["data-nodecourt"]);o!=null&&(s=!1,$("div#divPlayingList li").each(function(){o==$(this).children("a").text()&&(s=!0)}),s==!1&&($.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",headers:h,url:l,data:{MemberName:o,CourtName:i},cache:!1,success:function(t){var r=t,u="";r!=null&&(u=r.responseText);u==TBTTCONSTANT.SUCCESS_MESSAGE&&(c(i,n),loadPlayingList(),success(TBTTCONSTANT.SUCCESS_MESSAGE));t==TBTTCONSTANT.GENERIC_ERROR&&error(TBTTCONSTANT.GENERIC_ERROR)},error:function(n){if(n.status===401){window.location.href=n.Data.LogOnUrl;return}n.status===403?error(TBTTCONSTANT.UNAUTHORIZEDREQUEST):error(TBTTCONSTANT.GENERIC_ERROR)}}),e=$(r).html(),e=e!=null?e.replace(/^\s+|\s+$/g,""):"",(e==""||e=="00:00")&&($(r).html("00:00"),f=setInterval(function(){a(i,n,r);clearInterval(f)},1e3))));t.jstree(!0).open_all();t.jstree(!0).redraw()}}}}function v(n,t){var f=$(t).text(),o,i,s,a;if(f!=""&&$(t)!=null){o=f;f!=null&&f.length>0&&(f.toString().indexOf(":")!=-1?i=o.split(":"):f.toString().indexOf(".")!=-1&&(i=o.split(".")));var r=new Date,e="00:00",h=!1;r.setHours(0);r.setMinutes(0);r.setSeconds(0);i!=null&&(i.length>1?(r.setHours(0),i[1]>=60?(i[0]=parseInt(i[0])+parseInt(i[1])/60,i[1]=parseInt(i[1])%60,r.setSeconds(parseInt(i[1]))):r.setSeconds(i[1]),i[0]>=60?(r.setHours(1),r.setMinutes(Math.round(parseFloat(i[0])%60)),h=!0):r.setMinutes(parseInt(i[0]))):(r.setHours(0),r.setMinutes(0),r.setSeconds(0)));var c=new Date(r.valueOf()+1e3),l=c.toTimeString().split(" "),u=l[0].split(":");u!=null&&(u.length>1?(e=u[1]+":"+u[2],timecheck=u[1]):u.length>0&&(e=u[1]+":0",timecheck=u[1]));$(t).html(e);s=0;a=!1;e.toString().indexOf(":")!=-1&&(elapsedTimeArray="",elapsedTimeArray=e.toString().split(":"),elapsedTimeArray!=null&&elapsedTimeArray.length>0&&(s=elapsedTimeArray[0],elapsedSeconds=elapsedTimeArray[1],(s>=y||h)&&$(t).html("")));return}}function a(t,i,r){var e="",o=0,s="",h=!1,l=0,w=new Date,f="",a=0,p=!1,u,y;$(i+" li").each(function(){l=l+1;e=$(this);s=e.children("a").data("nodeid");s!=-999&&(child=e.children("a"),o=e.children("a").data("gameelapsedtime"),a=e.children("a").data("nodecount"),o!=null&&(h=!0))});h&&(o.toString().indexOf(".")!=-1&&(u=o.toString().split(".")),o.toString().indexOf(":")!=-1&&(u="",u=o.toString().split(":")),u!=null?u.length>1?f=u[0]+":"+u[1]:u.length>0&&(f=u[0]):f=o.toString()+":00",$(r).html(f));(f!=""&&f!="00:00"||a>0)&&(y=setInterval(function(){if(f=$(r).text(),f==""){p=!0;c(t,n);loadPlayingList();var u=0;$(n+" li").each(function(){e=$(this);s=e.children("a").data("nodeid");s!=-999&&(u=u+1)});u>=1?($(r).html("00:01"),v(t,r,i)):clearInterval(y)}else v(t,r,i)},1e3));return}var t="",s=!1,u=[],e=[],h=[],o=[],i="Court-7",n="#divCourt7",r="#divCourt7Footer",y=Number(TBTTCONSTANT.ELAPSED_MINUTES_CONSTANT),f,l=0;$("div#divPlayingList").on("mousedown touchstart","a.jstree-anchor",function(){s=!0;u=[];e=[];h=[];o=[];for(var i=$("#divPlayingList").jstree(!0),t=$(this).closest("li"),n=t.attr("id");t!=null;){n=i.get_node(t);n!=null&&n.data!=null&&n.data.nodeid!=-999&&(u.push(t.children("a").text()),e.push(n.data.nodeid),h.push(n.data.nodeorderid),o.push(n.data.nodemembershiptype));n=i.get_parent(n);try{if(n=="#")break;t=$("#"+n)}catch(r){}}return});$(n).on("touchend","a.jstree-anchor",function(){var p;if(l==0)l=1,l=setTimeout(function(){l=0},600);else{var g=$("div#urlDeleteFromGameBoardByMembershipID").data("request-url"),nt=$("[name=__RequestVerificationToken]").val(),b={};b.__RequestVerificationToken=nt;var k=$(n).jstree(!0),it=$("#divPlayingList").jstree(!0),w=0,tt=w;s=!0;u=[];e=[];h=[];o=[];for(var k=$(n).jstree(!0),y=$(this).closest("li"),v=y.attr("id");y!=null;){v=k.get_node(y);v!=null&&v.data!=null&&v.data.nodeid!=-999&&u.push(y.children("a").text());v=k.get_parent(v);try{if(v=="#")break;y=$("#"+v)}catch(rt){}}for(w=u.length-1,tt=w;w>=0;){var y=u.pop(),ut=e.pop(),ft=h.pop(),et=o.pop(),d=!1;$("div#divPlayingList li").each(function(){y==$(this).children("a").text()&&(d=!0)});d==!1&&($.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",headers:b,url:g,data:{MemberName:y,CourtName:i},cache:!1,success:function(t){var r=t,u="";r!=null&&(u=r.responseText);u==TBTTCONSTANT.SUCCESS_MESSAGE&&(c(i,n),loadPlayingList(),success(TBTTCONSTANT.SUCCESS_MESSAGE));t==TBTTCONSTANT.GENERIC_ERROR&&error(TBTTCONSTANT.GENERIC_ERROR)},error:function(n){if(n.status===401){window.location.href=n.Data.LogOnUrl;return}n.status===403?error(TBTTCONSTANT.UNAUTHORIZEDREQUEST):error(TBTTCONSTANT.GENERIC_ERROR)}}),p=$(r).html(),p=p!=null?p.replace(/^\s+|\s+$/g,""):"",(p==""||p=="00:00")&&($(r).html("00:00"),f=setInterval(function(){a(i,n,r);clearInterval(f)},1e3)));w--}t.jstree(!0).open_all();t.jstree(!0).redraw();s=!1;u=[];e=[];o=[]}return});$(n).on("mouseup touchend","a.jstree-anchor",function(){var l;if(s=!0,s==!0){var k=$("div#urlSaveGameBoard").data("request-url"),d=$("[name=__RequestVerificationToken]").val(),w={};w.__RequestVerificationToken=d;for(var tt=$(n).jstree(!0),it=$("#divPlayingList").jstree(!0),v=u.length-1,rt=v;v>=0;){var b=u.pop(),y=e.pop(),g=h.pop(),nt=o.pop(),p=!1;$(n+" li").each(function(){b==$(this).children("a").text()&&(p=!0)});(y==-999||y==null)&&(p=!0);p==!1&&($.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",headers:w,url:k,data:{MembershipID:y,MemberName:b,CourtName:i,OrderID:g,MembershipType:nt},cache:!1,success:function(t){var r=t,u="",f;r!=null&&(u=r.responseText);u==TBTTCONSTANT.SUCCESS_MESSAGE&&(c(i,n),loadPlayingList(),f="",success(TBTTCONSTANT.SUCCESS_MESSAGE));t==TBTTCONSTANT.GENERIC_ERROR&&error(TBTTCONSTANT.GENERIC_ERROR)},error:function(n){if(n.status===401){window.location.href=n.Data.LogOnUrl;return}n.status===403?error(TBTTCONSTANT.UNAUTHORIZEDREQUEST):error(TBTTCONSTANT.GENERIC_ERROR)}}),l=$(r).html(),l=l!=null?l.replace(/^\s+|\s+$/g,""):"",(l==""||l=="00:00")&&($(r).html("00:00"),f=setInterval(function(){a(i,n,r);clearInterval(f)},1e3)));v--}t.jstree(!0).open_all();t.jstree(!0).redraw()}s=!1;u=[];e=[];o=[];return});c(i,n);f=setInterval(function(){var t=0;$(n+" li").each(function(){current=$(this);nodeID=current.children("a").data("nodeid");nodeID!=-999&&(t=t+1)});t>=1?(a(i,n,r),clearInterval(f)):clearInterval(f)},1e3)});